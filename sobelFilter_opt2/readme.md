# Sobel Filter Implementation with HLS

This project implements a Sobel filter using High-Level Synthesis (HLS) for FPGA deployment. It includes C++ source code for the Sobel filter, a testbench for verification, and Python scripts for generating input stimuli and converting the output to a viewable image.

## Overview

The Sobel filter is an edge detection algorithm used in image processing. This implementation is optimized for FPGA deployment using Xilinx Vitis HLS, focusing on reducing memory usage and minimizing latency.

## File Structure

*   `sobelFilter.hpp`: Header file containing the function declaration for the Sobel filter.
*   `sobelFilter.cpp`: C++ source code implementing the Sobel filter algorithm. It uses line buffers and a sliding window to reduce memory usage and optimize for latency.
*   `sobelFilter_tb.cpp`: C++ testbench for verifying the Sobel filter implementation. It reads input image data from `pic_in.txt`, runs the Sobel filter, and compares the output with a golden reference. The output is written to `pic_out.txt`.
*   `png2txt.py`: Python script to convert a PNG image to a text file (`pic_in.txt`) containing pixel data, suitable as input for the testbench.
*   `txt2png.py`: Python script to convert the output text file (`pic_out.txt`) generated by the testbench back into a PNG image for visualization.
*   `run_hls.tcl`: Tcl script for running the Vitis HLS flow, including C simulation, C synthesis, and co-simulation.
*   `pic_in.txt`: Input image data in text format, generated by `png2txt.py`.
*   `pic_out.txt`: Output image data in text format, generated by `sobelFilter_tb.cpp`.
*   `test.png`: Example input image.
*   `prompt.md`: Prompt used to optimize HLS C++ design.
*   `readme.md`: This file, providing an overview of the project.

## Requirements

*   Xilinx Vitis HLS
*   Python 3
*   PIL (Pillow) library for Python (`pip install Pillow`)

## Usage

### 1. Generate Input Stimulus

1.  Place the input image (e.g., `test.png`) in the same directory as `png2txt.py`.
2.  Run the `png2txt.py` script to convert the PNG image to a text file (`pic_in.txt`):

    ```bash
    python png2txt.py
    ```

    You can modify the input and output paths, and resolution in the script.

### 2. Run Vitis HLS

1.  Open Vitis HLS and navigate to the project directory.
2.  Execute the `run_hls.tcl` script:

    ```tcl
    vitis_hls -f run_hls.tcl
    ```

    This script performs C simulation, C synthesis, and co-simulation. You can modify the script to enable or disable specific steps.

### 3. Verify the Output

1.  After the HLS flow completes, the output pixel data will be in `pic_out.txt`.
2.  Run the `txt2png.py` script to convert the text file back to a PNG image (`output.png`):

    ```bash
    python txt2png.py
    ```

    You can modify the input and output paths, and resolution in the script.

3.  View the generated `output.png` to verify the Sobel filter's output.

## HLS Optimizations

The following optimizations have been applied to the HLS design:

*   **Line Buffers:** Two line buffers (`lineBuffer1`, `lineBuffer2`) are used to store the previous two lines of image pixels, reducing memory requirements.
*   **Sliding Window:** A 3x3 pixel window (`pixelWindow`) is implemented using an array partition to enable parallel processing of the Sobel filter operation.
*   **Dataflow Optimization:** The design is pipelined to process one pixel per clock cycle, minimizing latency.

## Testbench

The testbench (`sobelFilter_tb.cpp`) reads pixel data from `pic_in.txt`, feeds it to the Sobel filter, and writes the output to `pic_out.txt`. It also includes a comparison against a golden reference to verify the correctness of the implementation.

## LLM Prompt

The `prompt.md` file contains the prompt used to guide the LLM in optimizing the HLS C++ design. It emphasizes reducing memory usage and minimizing latency.

## Notes

*   Ensure that the input image resolution matches the `WIDTH` and `HEIGHT` parameters defined in `sobelFilter.hpp`.
